#@PROJECT_NAME@ main makefile
#
# this actually just invokes the cmake generated makefile in @CMAKE_BINARY_DIR@
#
# Makefile.in is just a template; the actual Makefile is generated from it via
# ./configure or a manual cmake invocation.


# the directory where the original media files are in
AGE2DIR = /dev/null

# the directory where converted files will be put
DATA_DIR = ./data

# this list specifies needed media files for the convert script
# TODO: don't rely on the make system, let our binary call the convert script
needed_media = graphics:*.* terrain:*.* sounds0:*.* sounds1:*.* gamedata0:*.* gamedata1:*.* gamedata2:*.* interface:*.*


binary = @CMAKE_BINARY_DIR@/@PROJECT_NAME@

runargs = --data=$(DATA_DIR)

.PHONY: all
all: @PROJECT_NAME@

.PHONY: @PROJECT_NAME@
@PROJECT_NAME@:
	@make -C @CMAKE_BINARY_DIR@/

.PHONY: install
install:
	@make -C @CMAKE_BINARY_DIR@/ install

.PHONY: media
media:
	python3 convert -v media -o $(DATA_DIR)/age/ $(AGE2DIR) $(needed_media)

.PHONY: medialist
medialist:
	@echo "$(needed_media)"

.PHONY: run
run: @PROJECT_NAME@
	$(binary) $(runargs)

.PHONY: runmem
runmem: @PROJECT_NAME@
	valgrind --leak-check=full --track-origins=yes -v $(binary) $(runargs)

.PHONY: rungdb
rungdb: @PROJECT_NAME@
	gdb --args $(binary) $(runargs)

.PHONY: doc
doc:
	@make -C @CMAKE_BINARY_DIR@/ doc

.PHONY: clean
clean:
	@make -C @CMAKE_BINARY_DIR@/ clean

.PHONY: mrproper
mrproper:
	rm -rf .bin bin data/age

.PHONY: help
help: bin/Makefile
	@echo "@PROJECT_NAME@ make system"
	@echo ""
	@echo "targets:"
	@echo ""
	@echo "@PROJECT_NAME@   -> compile main binary"
	@echo "media     -> convert media files, usage: make media AGE2DIR=~/.wine/ms-games/age2"
	@echo "medialist -> list needed media files for current version"
	@echo "doc       -> create documentation files"
	@echo "clean     -> clean up object files"
	@echo "mrproper  -> clean up everything: configure stuff, binary files, media files"
	@echo ""
	@echo "run       -> run @PROJECT_NAME@"
	@echo "runmem    -> run valgrind, analyze for memleaks."
	@echo "rungdb    -> run gdb, for debugging etc."
	@echo ""
	@echo ""
	@echo "Now follows the CMake help. (= make -C @CMAKE_BINARY_DIR@/) :"
	@make -C @CMAKE_BINARY_DIR@/ help
